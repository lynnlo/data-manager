import{ax as e,at as F,ay as s,ap as j,az as L,k as v,aA as k,C as A,B as E,$ as M,W as R,aB as D,aC as z}from"./@mui-f3787986.js";import{r as C,a as H}from"./react-12317535.js";import{R as q}from"./react-dom-9043644b.js";import{l as G}from"./ra-data-local-storage-b6c92784.js";import{A as K}from"./react-admin-f695f4f1.js";import{ah as V}from"./ra-core-26b24cdf.js";import{C as S,L as W,D as J,F as Q,T as P,B as O,N as X,b as Y,S as I,c as w,d as _,e as $,f as B,E as Z,g as N,h as ee,i as te,j as ae}from"./ra-ui-materialui-58e6f39f.js";import"./@babel-4b4a8c5a.js";import"./@emotion-d6ba3467.js";import"./hoist-non-react-statics-691fe6cb.js";import"./stylis-581c9ed0.js";import"./clsx-1229b3e0.js";import"./react-transition-group-a6ae2adb.js";import"./@popperjs-0e7ee0a2.js";import"./scheduler-04ce0582.js";import"./ra-data-fakerest-622622f7.js";import"./fakerest-552f0250.js";import"./lodash-7ec777e5.js";import"./ra-language-english-02fcc574.js";import"./ra-i18n-polyglot-eb4291d7.js";import"./node-polyglot-87c88650.js";import"./array.prototype.foreach-b8d9d036.js";import"./define-properties-0d7bd0f6.js";import"./object-keys-dbad82bd.js";import"./has-property-descriptors-a37c6ee2.js";import"./get-intrinsic-7ad4ecdb.js";import"./has-symbols-0e5b2b17.js";import"./function-bind-22e7ee79.js";import"./has-26d28e02.js";import"./call-bind-d434ea07.js";import"./es-abstract-aba81ebc.js";import"./is-callable-7492318c.js";import"./object-inspect-9b58692b.js";import"./es-to-primitive-8073b5b3.js";import"./is-date-object-3b5131b4.js";import"./has-tostringtag-7fd0be08.js";import"./is-symbol-5383681d.js";import"./safe-regex-test-32ecb016.js";import"./is-regex-b2f83af0.js";import"./is-string-c907b945.js";import"./es-array-method-boxes-properly-96cc27a2.js";import"./object.entries-497e6c94.js";import"./string.prototype.trim-74b084d4.js";import"./query-string-6a1177e4.js";import"./strict-uri-encode-a47dbb00.js";import"./decode-uri-component-dd9600af.js";import"./split-on-first-160c8dc4.js";import"./filter-obj-31d61f1e.js";import"./react-query-4d41bbae.js";import"./react-router-2eefc5ae.js";import"./@remix-run-fd712092.js";import"./jsonexport-57422552.js";import"./inflection-78216119.js";import"./eventemitter3-0e0e7991.js";import"./history-a3b20500.js";import"./react-is-147ad7aa.js";import"./react-hook-form-22e22630.js";import"./prop-types-4d501b15.js";import"./react-router-dom-84bf4029.js";import"./react-error-boundary-a3724ffa.js";(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))u(a);new MutationObserver(a=>{for(const t of a)if(t.type==="childList")for(const m of t.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&u(m)}).observe(document,{childList:!0,subtree:!0});function o(a){const t={};return a.integrity&&(t.integrity=a.integrity),a.referrerpolicy&&(t.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?t.credentials="include":a.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function u(a){if(a.ep)return;a.ep=!0;const t=o(a);fetch(a.href,t)}})();const c=G({});let re=()=>{c.getList("users",{filter:{alive:!0},sort:{field:"name",order:"ascending"},pagination:{page:1,perPage:200}}).then(r=>{let f=r.data,o={};f.forEach(t=>{o[t.team]?o[t.team].push(t):o[t.team]=[t]});let u=Object.keys(o),a=[];Object.keys(o).forEach(t=>{let m=o[t],i=u[Math.floor(Math.random()*u.length)],b=0;for(;!i||m[0].history.includes(i)||i===t||a.includes(i);)if(i=u[Math.floor(Math.random()*u.length)],b++,b>100){i="No team found!";break}a.push(i),m.forEach(p=>{c.update("users",{id:p.id,data:{target:i,history:[...p.history,i]}})})})})},ie=()=>{c.getList("users",{sort:{field:"name",order:"ascending"},pagination:{page:1,perPage:200}}).then(r=>{r.data.forEach(o=>{c.update("users",{id:o.id,data:{target:"",history:[]}})})})},se=()=>{let[r,f]=C.useState(-1),[o,u]=C.useState(-1),[a,t]=C.useState(-1),[m,i]=C.useState(-1);c.getList("users",{filter:{alive:!0},sort:{field:"name",order:"ascending"},pagination:{page:1,perPage:200}}).then(l=>{setTimeout(()=>{f(l.total)},300)}),c.getList("users",{sort:{field:"name",order:"ascending"},pagination:{page:1,perPage:200}}).then(l=>{let y=l.data,h=0;y.forEach(g=>{h+=g.eliminations}),setTimeout(()=>{u(h)},800)}),c.getList("users",{filter:{alive:!0},sort:{field:"name",order:"ascending"},pagination:{page:1,perPage:200}}).then(l=>{let y=l.data,h={};y.forEach(g=>{h[g.team]?h[g.team].push(g):h[g.team]=[g]}),setTimeout(()=>{i(Object.keys(h).length)},1e3)}),c.getList("users",{filter:{bought_back:!0},sort:{field:"name",order:"ascending"},pagination:{page:1,perPage:200}}).then(l=>{setTimeout(()=>{t(l.total)},500)});let[b,p]=C.useState(!1),[n,d]=C.useState(!1);return e(F,{style:{margin:"1em"},children:s(j,{children:[s(L,{children:[e(v,{variant:"h2",sx:{m:2},children:" Dashboard "}),e("br",{}),s(k,{container:!0,spacing:2,children:[s(k,{item:!0,xs:12,sm:6,children:[e(v,{variant:"h6",sx:{m:2},children:" Total Alive Participants: "}),r===-1?e(A,{}):s(v,{variant:"h1",sx:{m:2},children:[" ",r," "]})]}),s(k,{item:!0,xs:12,sm:6,children:[e(v,{variant:"h6",sx:{m:2},children:" Total Eliminations: "}),o===-1?e(A,{}):s(v,{variant:"h1",sx:{m:2},children:[" ",o," "]})]}),s(k,{item:!0,xs:12,sm:6,children:[e(v,{variant:"h6",sx:{m:2},children:" Total Alive Teams: "}),m===-1?e(A,{}):s(v,{variant:"h1",sx:{m:2},children:[" ",m," "]})]}),s(k,{item:!0,xs:12,sm:6,children:[e(v,{variant:"h6",sx:{m:2},children:" Total Amount Raised: "}),r===-1||a===-1?e(A,{}):s(v,{variant:"h1",sx:{m:2},children:[" $",20*r+10*a," "]})]})]})]}),s(L,{children:[e(E,{variant:"contained",startIcon:e(M,{}),sx:{m:2},onClick:()=>{p(!0)},children:"Assign Targets"}),e(E,{variant:"contained",startIcon:e(R,{}),color:"error",sx:{m:2},onClick:()=>{d(!0)},children:"Clear History"}),e(S,{isOpen:b,title:"Assign Targets",content:"Are you sure you want to update the assigned targets?",onConfirm:()=>{re(),p(!1),window.location.href="/senior-assassin-game/#/users",window.location.reload()},onClose:()=>{p(!1)}}),e(S,{isOpen:n,title:"Clear Targets",content:"Are you sure you want to clear all targets and history?",onConfirm:()=>{ie(),d(!1),window.location.href="/senior-assassin-game/#/users",window.location.reload()},onClose:()=>{d(!1)}})]})]})})},oe=({basePath:r})=>{let[f,o]=C.useState(!1),u=()=>{let t=document.createElement("input");t.type="file",t.accept=".csv",t.click(),t.onchange=()=>{c.getList("users",{sort:{field:"name",order:"ascending"},pagination:{page:1,perPage:200}}).then(i=>{i.data.forEach(p=>{c.delete("users",{id:p.id})})});let m=new FileReader;m.readAsText(t.files[0]),m.onload=()=>{let b=m.result.split(`
`);b.shift(),b.forEach(p=>{let n=p.split(",");if(console.log(n),n.length!==8){console.log("Invalid CSV");return}let d=n[0],l=n[1],y=n[2],h=n[3]==="true",g=n[4]==="true",x=n[5]||"",T=n[6].split(";")||[],U=n[7].split(";")||[];c.create("users",{data:{id:d,name:l,team:y,alive:h,bought_back:g,target:x,history:T,eliminations:U}}),window.location.reload()})}}};return s(ee,{children:[e(te,{size:"large",basepath:r}),e(E,{size:"large",color:"primary",startIcon:e(D,{}),onClick:()=>{c.getList("users",{sort:{field:"name",order:"ascending"},pagination:{page:1,perPage:200}}).then(t=>{let m=t.data,i=`id,name,team,alive,bought_back,target,history,eliminations
`;m.forEach(d=>{i+=`${d.id},${d.name},${d.team},${d.alive},${d.bought_back},${d.target},${d.history.join(";")},${d.eliminations.join(";")}
`});let b=new Blob([i],{type:"text/csv"}),p=window.URL.createObjectURL(b),n=document.createElement("a");n.href=p,n.download="users.csv",n.click()})},children:"Export"}),e(E,{size:"large",color:"primary",startIcon:e(z,{}),onClick:()=>{o(!0)},children:"Import"}),e(S,{isOpen:f,title:"Import Users",content:"This will delete all users and import new ones. Are you sure?",onConfirm:()=>{u(),o(!1)},onClose:()=>{o(!1)}})]})},ne=()=>e(W,{actions:e(oe,{}),children:s(J,{children:[e(Q,{label:"Name",render:r=>e(E,{color:r.alive?"success":"error",onClick:()=>{window.location.href="/senior-assassin-game/#/users/"+r.id},children:r.name})}),e(P,{source:"team"}),e(P,{source:"target"}),e(O,{source:"alive"}),e(O,{source:"bought_back"}),e(X,{source:"eliminations"})]})}),le=()=>{let[r,f]=C.useState(""),[o,u]=C.useState(!1),[a,t]=C.useState(""),[m,i]=C.useState(!1),b=l=>{let y=l.target.value;f(y),c.getList("users",{sort:{field:"name",order:"ascending"},pagination:{page:1,perPage:200}}).then(h=>{let g=h.data,x={};g.forEach(T=>{x[T.team]?x[T.team].push(T):x[T.team]=[T]}),x[y]?u(!0):u(!1)})},p=l=>{let y=l.target.value;t(y),c.getList("users",{sort:{field:"name",order:"ascending"},pagination:{page:1,perPage:200}}).then(h=>{let g=h.data,x=[];g.forEach(T=>{x.push(T.name)}),x.includes(y)?i(!0):i(!1)})},n=l=>{l.preventDefault(),c.create("users",{data:{name:a,team:r,alive:!0,bought_back:!1,eliminations:[]}})};return e(Y,{children:s(I,{toolbar:e(()=>s(ae,{children:[e(E,{disabled:r===""&&a==="",variant:"contained",sx:{m:2},color:"success",onClick:l=>{n(l),window.location.href="/senior-assassin-game/#/users"},children:" Save and Return "}),e(E,{disabled:r===""&&a==="",variant:"outline",sx:{m:2},onClick:l=>{n(l),window.location.reload(!1)},children:" Save and Add  "}),e(E,{variant:"outline",sx:{m:2},onClick:()=>{window.location.href="/senior-assassin-game/#/users"},children:" Cancel "})]}),{}),children:[e(w,{label:"Participant Name",source:"name",onChange:p}),e(w,{label:"Team Name",source:"team",onChange:b}),e(w,{label:"Target",source:"target"}),e(_,{label:"Eliminations",source:"eliminations"}),e($,{source:"history",children:e(B,{children:e(w,{})})}),r!==""&&(o?s(v,{variant:"h6",sx:{m:2},style:{color:"green"},children:[" '",r,"' is already a team. "]}):s(v,{variant:"h6",sx:{m:2},children:[" '",r,"' will create a new team. "]})),a!==""&&m&&s(v,{variant:"h6",sx:{m:2},style:{color:"red"},children:[" '",a,"' is already a participant. Consider changing the name. "]})]})})},me=()=>e(Z,{children:s(I,{children:[e(w,{source:"name"}),e(w,{source:"team"}),e(w,{source:"target"}),e(N,{source:"alive"}),e(N,{source:"bought_back"}),e(_,{label:"Eliminations",source:"eliminations"}),e($,{source:"history",children:e(B,{children:e(w,{})})})]})});function ce(){return e(K,{dataProvider:c,dashboard:se,title:"Data Manager",children:e(V,{name:"users",list:ne,create:le,edit:me})})}q.render(e(H.StrictMode,{children:e(ce,{})}),document.getElementById("root"));
