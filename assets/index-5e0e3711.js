import{ax as e,at as z,ay as s,ap as H,az as $,k as y,aA as L,C as O,B as x,$ as q,W as G,aB as K,aC as V}from"./@mui-f3787986.js";import{r as u,a as W}from"./react-12317535.js";import{R as J}from"./react-dom-9043644b.js";import{l as Q}from"./ra-data-local-storage-b6c92784.js";import{A as X}from"./react-admin-f695f4f1.js";import{ah as Y}from"./ra-core-26b24cdf.js";import{C as _,L as Z,D as ee,F as te,T as B,B as U,N as ae,b as re,S as M,c as T,d as R,e as j,f as D,E as ie,g as F,h as se,i as oe,j as ne}from"./ra-ui-materialui-58e6f39f.js";import"./@babel-4b4a8c5a.js";import"./@emotion-d6ba3467.js";import"./hoist-non-react-statics-691fe6cb.js";import"./stylis-581c9ed0.js";import"./clsx-1229b3e0.js";import"./react-transition-group-a6ae2adb.js";import"./@popperjs-0e7ee0a2.js";import"./scheduler-04ce0582.js";import"./ra-data-fakerest-622622f7.js";import"./fakerest-552f0250.js";import"./lodash-7ec777e5.js";import"./ra-language-english-02fcc574.js";import"./ra-i18n-polyglot-eb4291d7.js";import"./node-polyglot-87c88650.js";import"./array.prototype.foreach-b8d9d036.js";import"./define-properties-0d7bd0f6.js";import"./object-keys-dbad82bd.js";import"./has-property-descriptors-a37c6ee2.js";import"./get-intrinsic-7ad4ecdb.js";import"./has-symbols-0e5b2b17.js";import"./function-bind-22e7ee79.js";import"./has-26d28e02.js";import"./call-bind-d434ea07.js";import"./es-abstract-aba81ebc.js";import"./is-callable-7492318c.js";import"./object-inspect-9b58692b.js";import"./es-to-primitive-8073b5b3.js";import"./is-date-object-3b5131b4.js";import"./has-tostringtag-7fd0be08.js";import"./is-symbol-5383681d.js";import"./safe-regex-test-32ecb016.js";import"./is-regex-b2f83af0.js";import"./is-string-c907b945.js";import"./es-array-method-boxes-properly-96cc27a2.js";import"./object.entries-497e6c94.js";import"./string.prototype.trim-74b084d4.js";import"./query-string-6a1177e4.js";import"./strict-uri-encode-a47dbb00.js";import"./decode-uri-component-dd9600af.js";import"./split-on-first-160c8dc4.js";import"./filter-obj-31d61f1e.js";import"./react-query-4d41bbae.js";import"./react-router-2eefc5ae.js";import"./@remix-run-fd712092.js";import"./jsonexport-57422552.js";import"./inflection-78216119.js";import"./eventemitter3-0e0e7991.js";import"./history-a3b20500.js";import"./react-is-147ad7aa.js";import"./react-hook-form-22e22630.js";import"./prop-types-4d501b15.js";import"./react-router-dom-84bf4029.js";import"./react-error-boundary-a3724ffa.js";(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))p(a);new MutationObserver(a=>{for(const t of a)if(t.type==="childList")for(const m of t.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&p(m)}).observe(document,{childList:!0,subtree:!0});function r(a){const t={};return a.integrity&&(t.integrity=a.integrity),a.referrerpolicy&&(t.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?t.credentials="include":a.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function p(a){if(a.ep)return;a.ep=!0;const t=r(a);fetch(a.href,t)}})();const l=Q({});let le=()=>{console.log(l.getList()),l.getList("users",{filter:{alive:!0},sort:{field:"name",order:"ascending"},pagination:{page:1,perPage:200}}).then(o=>{let f=o.data,r={};f.forEach(t=>{r[t.team]?r[t.team].push(t):r[t.team]=[t]});let p=Object.keys(r),a=[];Object.keys(r).forEach(t=>{let m=r[t],i=p[Math.floor(Math.random()*p.length)],h=0;for(;!i||m[0].history.includes(i)||i===t||a.includes(i);)if(i=p[Math.floor(Math.random()*p.length)],h++,h>100){i="No team found!";break}a.push(i),m.forEach(v=>{l.update("users",{id:v.id,data:{target:i,history:[...v.history,i]}})})})})},me=()=>{l.getList("users",{sort:{field:"name",order:"ascending"},pagination:{page:1,perPage:200}}).then(o=>{o.data.forEach(r=>{l.update("users",{id:r.id,data:{target:"",history:[]}})})})},ce=()=>{let[o,f]=u.useState(-1),[r,p]=u.useState(-1),[a,t]=u.useState(-1),[m,i]=u.useState(-1),[h,v]=u.useState(-1);l.getList("users",{filter:{alive:!0},sort:{field:"name",order:"ascending"},pagination:{page:1,perPage:200}}).then(g=>{setTimeout(()=>{f(g.total)},300)}),l.getList("users",{filter:{},sort:{field:"name",order:"ascending"},pagination:{page:1,perPage:200}}).then(g=>{setTimeout(()=>{p(g.total)},300)}),l.getList("users",{sort:{field:"name",order:"ascending"},pagination:{page:1,perPage:200}}).then(g=>{let E=g.data,b=0;E.forEach(C=>{b+=parseInt(C.eliminations)}),setTimeout(()=>{t(b)},800)}),l.getList("users",{filter:{alive:!0},sort:{field:"name",order:"ascending"},pagination:{page:1,perPage:200}}).then(g=>{let E=g.data,b={};E.forEach(C=>{b[C.team]?b[C.team].push(C):b[C.team]=[C]}),setTimeout(()=>{v(Object.keys(b).length)},1e3)}),l.getList("users",{filter:{bought_back:!0},sort:{field:"name",order:"ascending"},pagination:{page:1,perPage:200}}).then(g=>{setTimeout(()=>{i(g.total)},500)});let[n,d]=u.useState(!1),[A,w]=u.useState(!1);return e(z,{style:{margin:"1em"},children:s(H,{children:[s($,{children:[e(y,{variant:"h2",sx:{m:2},children:" Dashboard "}),e("br",{}),s(L,{container:!0,spacing:2,children:[s(L,{item:!0,xs:12,sm:6,children:[e(y,{variant:"h6",sx:{m:2},children:" Total Alive Participants: "}),r===-1?e(O,{}):s(y,{variant:"h1",sx:{m:2},children:[" ",o," "]})]}),s(L,{item:!0,xs:12,sm:6,children:[e(y,{variant:"h6",sx:{m:2},children:" Total Eliminations: "}),a===-1?e(O,{}):s(y,{variant:"h1",sx:{m:2},children:[" ",a," "]})]}),s(L,{item:!0,xs:12,sm:6,children:[e(y,{variant:"h6",sx:{m:2},children:" Total Alive Teams: "}),h===-1?e(O,{}):s(y,{variant:"h1",sx:{m:2},children:[" ",h," "]})]}),s(L,{item:!0,xs:12,sm:6,children:[e(y,{variant:"h6",sx:{m:2},children:" Total Amount Raised: "}),r===-1||m===-1?e(O,{}):s(y,{variant:"h1",sx:{m:2},children:[" $",20*r+10*m," "]})]})]})]}),s($,{children:[e(x,{variant:"contained",startIcon:e(q,{}),sx:{m:2},onClick:()=>{d(!0)},children:"Assign Targets"}),e(x,{variant:"contained",startIcon:e(G,{}),color:"error",sx:{m:2},onClick:()=>{w(!0)},children:"Clear History"}),e(_,{isOpen:n,title:"Assign Targets",content:"Are you sure you want to update the assigned targets?",onConfirm:()=>{le(),d(!1),window.location.href="/senior-assassin-game/#/users",window.location.reload()},onClose:()=>{d(!1)}}),e(_,{isOpen:A,title:"Clear Targets",content:"Are you sure you want to clear all targets and history?",onConfirm:()=>{me(),w(!1),window.location.href="/senior-assassin-game/#/users",window.location.reload()},onClose:()=>{w(!1)}})]})]})})},de=({basePath:o})=>{let[f,r]=u.useState(!1),p=()=>{let t=document.createElement("input");t.type="file",t.accept=".csv",t.click(),t.onchange=()=>{l.getList("users",{sort:{field:"name",order:"ascending"},pagination:{page:1,perPage:200}}).then(i=>{i.data.forEach(v=>{l.delete("users",{id:v.id})})});let m=new FileReader;m.readAsText(t.files[0]),m.onload=()=>{let h=m.result.split(`
`);h.shift(),h.forEach(v=>{let n=v.split(",");if(console.log(n),n.length!==8){console.log("Invalid CSV");return}let d=n[0],A=n[1],w=n[2],g=n[3]==="true",E=n[4]==="true",b=n[5]||"",C=n[6].split(";")||[],c=n[7]||0;l.create("users",{data:{id:d,name:A,team:w,alive:g,bought_back:E,target:b,history:C,eliminations:c}}),window.location.reload()})}}};return s(se,{children:[e(oe,{size:"large",basepath:o}),e(x,{size:"large",color:"primary",startIcon:e(K,{}),onClick:()=>{l.getList("users",{sort:{field:"name",order:"ascending"},pagination:{page:1,perPage:200}}).then(t=>{let m=t.data,i=`id,name,team,alive,bought_back,target,history,eliminations
`;m.forEach(d=>{i+=`${d.id},${d.name},${d.team},${d.alive},${d.bought_back},${d.target},${d.history.join(";")},${d.eliminations}
`});let h=new Blob([i],{type:"text/csv"}),v=window.URL.createObjectURL(h),n=document.createElement("a");n.href=v,n.download="users.csv",n.click()})},children:"Export"}),e(x,{size:"large",color:"primary",startIcon:e(V,{}),onClick:()=>{r(!0)},children:"Import"}),e(_,{isOpen:f,title:"Import Users",content:"This will delete all users and import new ones. Are you sure?",onConfirm:()=>{p(),r(!1)},onClose:()=>{r(!1)}})]})},ue=()=>e(Z,{actions:e(de,{}),children:s(ee,{children:[e(te,{label:"Name",render:o=>e(x,{color:o.alive?"success":"error",onClick:()=>{window.location.href="/senior-assassin-game/#/users/"+o.id},children:o.name})}),e(B,{source:"team"}),e(B,{source:"target"}),e(U,{source:"alive"}),e(U,{source:"bought_back"}),e(ae,{source:"eliminations"})]})}),pe=()=>{let[o,f]=u.useState(""),[r,p]=u.useState(!1),[a,t]=u.useState(""),[m,i]=u.useState(!1),[h,v]=u.useState(0),[n,d]=u.useState([]),[A,w]=u.useState(""),g=c=>{let P=c.target.value;f(P),l.getList("users",{sort:{field:"name",order:"ascending"},pagination:{page:1,perPage:200}}).then(N=>{let I=N.data,k={};I.forEach(S=>{k[S.team]?k[S.team].push(S):k[S.team]=[S]}),k[P]?p(!0):p(!1)})},E=c=>{let P=c.target.value;t(P),l.getList("users",{sort:{field:"name",order:"ascending"},pagination:{page:1,perPage:200}}).then(N=>{let I=N.data,k=[];I.forEach(S=>{k.push(S.name)}),k.includes(P)?i(!0):i(!1)})},b=c=>{c.preventDefault(),l.create("users",{data:{name:a,team:o,target:A,alive:!0,bought_back:!1,eliminations:h,history:n}})};return e(re,{children:s(M,{toolbar:e(()=>s(ne,{children:[e(x,{disabled:o===""&&a==="",variant:"contained",sx:{m:2},color:"success",onClick:c=>{b(c),window.location.href="/senior-assassin-game/#/users"},children:" Save and Return "}),e(x,{disabled:o===""&&a==="",variant:"outline",sx:{m:2},onClick:c=>{b(c),window.location.reload(!1)},children:" Save and Add  "}),e(x,{variant:"outline",sx:{m:2},onClick:()=>{window.location.href="/senior-assassin-game/#/users"},children:" Cancel "})]}),{}),children:[e(T,{label:"Participant Name",source:"name",onChange:E}),e(T,{label:"Team Name",source:"team",onChange:g}),e(T,{label:"Target",source:"target",onChange:c=>w(c.target.value)}),e(R,{label:"Eliminations",source:"eliminations",onChange:c=>v(c.target.value)}),e(j,{source:"history",onChange:c=>d(c.target.value),children:e(D,{children:e(T,{})})}),o!==""&&(r?s(y,{variant:"h6",sx:{m:2},style:{color:"green"},children:[" '",o,"' is already a team. "]}):s(y,{variant:"h6",sx:{m:2},children:[" '",o,"' will create a new team. "]})),a!==""&&m&&s(y,{variant:"h6",sx:{m:2},style:{color:"red"},children:[" '",a,"' is already a participant. Consider changing the name. "]})]})})},he=()=>e(ie,{children:s(M,{children:[e(T,{source:"name"}),e(T,{source:"team"}),e(T,{source:"target"}),e(F,{source:"alive"}),e(F,{source:"bought_back"}),e(R,{label:"Eliminations",source:"eliminations"}),e(j,{source:"history",children:e(D,{children:e(T,{})})})]})});function ge(){return e(X,{dataProvider:l,dashboard:ce,title:"Data Manager",children:e(Y,{name:"users",list:ue,create:pe,edit:he})})}J.render(e(W.StrictMode,{children:e(ge,{})}),document.getElementById("root"));
